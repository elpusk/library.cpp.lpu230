<?xml version="1.0" encoding="UTF-8"?>

<!--
* history
*
* 2020.01.30 - package v 1.0.0 : coffee manager project(1.0.0.1). the first release.
* 2020.05.21 - package v 1.1.0 : coffee manager project(1.1.0.1). 2'nd release
* 2020.05.22 - package v 1.2.0 : coffee manager project(1.2.0.1). 3'th release
* 2020.06.09 - package v 1.3.0 : coffee manager project(1.3.0.1). 4'th release
* 2020.07.31 - package v 1.4.0 : coffee manager project(1.4.0.1). config-v1.1, control-v1.2, hlp_cert-1.1, help_client-v1.1.
* 2020.08.06 - package v 1.5.0 : coffee manager project(1.5.0.1).
* 2020.08.24 - package v 1.6.0 : coffee manager project(1.6.0.1).coffee_manager - v1.6, tg_lpu237_dll.dll - v4.0
* 2020.10.08 - package v 1.7.0 : coffee manager project(1.7.0.1).coffee_manager - v1.7.
*                              : add cf_bl_elpusk_hid.dll - v1.0
*                              : add tg_lpu237_fw.dll - v1.1(external).
*                              : add tg_rom.dll - v1.2(external).
* 2021.08.13 - package v 1.8.0 : coffee manager project(1.8.1.1).coffee_manager - v1.8.
*                              : updated tg_lpu237_fw.dll - v1.2(external).
*                              : add cm_boot_manager.exe - v1.0
*                              : add cm_bl_hid_elpusk.dll - v1.2
*                              : add sd_helloworld.dll - v1.0
*
* 2021.09.24 - package v 1.9.0  : coffee manager project(1.9.0.0).coffee_manager - v1.9.
*                               : cm_boot_manager.exe - v1.0
*                               : coffee_config.exe - v1.3
*                               : coffee_control.exe - v1.4
*                               : coffee_service.exe - v1.0
*                               : cf_bl_elpusk_hid.dll - v1.1
*                               : cm_bl_hid_elpusk.dll - v1.2
*                               : coffee_hlp_cert.dll - v1.1
*                               : coffee_hlp_client.dll - v1.6
*                               : sd_helloworld.dll - v1.0
*                               : tg_lpu237_dll.dll - v4.5
*                               : tg_lpu237_fw.dll - v1.2(external).
*                               : tg_rom.dll - v1.2(external).
*
* 2021.09.24 - package v 1.10.0 : coffee manager project(1.10.0.0).coffee_manager - v1.10.
*                               : cm_boot_manager.exe - v1.0
*                               : coffee_config.exe - v1.3
*                               : coffee_control.exe - v1.4
*                               : coffee_service.exe - v1.0
*                               : cf_bl_elpusk_hid.dll - v1.1
*                               : cm_bl_hid_elpusk.dll - v1.2
*                               : coffee_hlp_cert.dll - v1.1
*                               : coffee_hlp_client.dll - v1.6
*                               : sd_helloworld.dll - v1.2
*                               : tg_lpu237_dll.dll - v4.5
*                               : tg_lpu237_fw.dll - v1.2(external).
*                               : tg_rom.dll - v1.2(external).
*
* 2022.03.21 - package v 1.11.0 : coffee manager project(1.11.0.0).coffee_manager - v1.11.
*                               : cm_boot_manager.exe - v1.0
*                               : coffee_config.exe - v1.3
*                               : coffee_control.exe - v1.4
*                               : coffee_service.exe - v1.0
*                               : cf_bl_elpusk_hid.dll - v1.1
*                               : cm_bl_hid_elpusk.dll - v1.2
*                               : coffee_hlp_cert.dll - v1.1
*                               : coffee_hlp_client.dll - v1.6
*                               : sd_helloworld.dll - v1.2
*                               : tg_lpu237_dll.dll - v4.5
*                               : tg_lpu237_fw.dll - v1.2(external).
*                               : tg_rom.dll - v1.2(external).
*
* 2022.11.23 - package v 1.11.1 : coffee manager project(1.11.1.0).coffee_manager - v1.11.1 : change openssl to v1.1.1s
*                               : cm_boot_manager.exe - v1.0.1
*                               : coffee_config.exe - v1.3.1
*                               : coffee_control.exe - v1.4
*                               : coffee_service.exe - v1.0
*                               : cf_bl_elpusk_hid.dll - v1.1
*                               : cm_bl_hid_elpusk.dll - v1.2
*                               : coffee_hlp_cert.dll - v1.1.1
*                               : coffee_hlp_client.dll - v1.6.1
*                               : sd_helloworld.dll - v1.2
*                               : tg_lpu237_dll.dll - v4.5
*                               : tg_lpu237_fw.dll - v1.2(external).
*                               : tg_rom.dll - v1.2(external).
*                               : <?define Pre_ProductCode = "DD7577E8-48DB-40AD-84E9-E77725C8EC31"?>
*
* 2025.07 - package v 2.0.0     : coffee manager project(v2.0) - suuport windows 11 x64.
*                               : elpusk-hid-d.exe - v2.0.0(from v2.0, this is a new name of coffee_manager.exe)
*                               : tg_lpu237_dll.dll - v6.0
*                               : tg_lpu237_ibutton.dll - v6.0


-->

<!-- 기본적으로 %ProgramFiles%\Pre_DirName_ProductName\Pre_DirName_Manufacturer 형식으로 설치됨.-->
<!-- Pre_DirName_ 시작하는 정의값은 폴더의 이름임. -->
<?define Pre_DirName_Manufacturer = "Elpusk" ?>
<?define Pre_DirName_developer_id = "00000006" ?>
<?define Pre_DirName_ProductName = "coffee_manager" ?>
<?define Pre_DirName_ServiceName = "coffee_service" ?>

<?define Pre_Manufacturer = "Elpusk" ?>
<!-- Pre_Manufacturer name 은 Pre_Manufacturer 에 설정.-->
<?define Pre_ProductName = "coffee_manager"?>
<!-- product name 은 Pre_ProductName 에 설정.-->

<!-- Pre_ProductVersion 값이 변경되면, Pre_ProductCode 는 새로 생성해야함.-->
<?define Pre_ProductVersion = "2.0.0"?>
<?define Pre_ProductCode = "4E3250B3-83B2-4AE3-9C8E-165E8F21553C"?>

<!-- 같은 프로그래은 버전이 달라져도 Pre_ProductUpgradeCode 는 항상 동일해야 함.-->
<?define Pre_ProductUpgradeCode = "B9BF3037-BD17-4F00-BA59-C5CE301723D6"?>

<!-- 32비트면 Pre_PlatformPath 와 Pre_ProcessorArchitecture 값을 x86 으로 -->
<!-- 64비트면 Pre_PlatformPath 와 Pre_ProcessorArchitecture 값을 x64 으로 -->
<!-- Pre_ProcessorArchitecture 은 .NET 사용 할때만 의미 있음.-->
<?define Pre_PlatformPath = "x64"?>
<?define Pre_ProcessorArchitecture = "x64"?>
<!-- msil , x86, x64 or ia64-->

<!-- 1033(0x0409) en-US : English United States -->
<!-- 1042(0x0412) ko-KR : Korean korea -->
<?define Pre_LCID = "1033" ?>
<!-- The decimal language ID (LCID) for the product. -->

<?define Pre_HomePage = "https://blog.naver.com/elpusk" ?>

<?if $(var.Pre_PlatformPath) = "x64" ?>
<?define Pre_Win64 = "yes" ?>
<!-- Win64 = "$(var.Pre_Win64)" -->
<?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?else ?>
<?define Pre_Win64 = "no" ?>
<?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?endif ?>


<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
    Id="$(var.Pre_ProductCode)"
    Name="$(var.Pre_ProductName)"
    Language="$(var.Pre_LCID)"
    Version="$(var.Pre_ProductVersion)"
    Manufacturer="$(var.Pre_Manufacturer)"
    UpgradeCode="$(var.Pre_ProductUpgradeCode)"
    >
    <Package
      InstallerVersion="400"
      Compressed="yes"
      InstallScope="perMachine"
      Comments="$(var.Pre_ProductName) v$(var.Pre_ProductVersion) Windows Installer Package $(var.Pre_PlatformPath)"
      Platform="$(var.Pre_PlatformPath)"
      />
    <Media Id="1" Cabinet="$(var.TargetName).cab" EmbedCab="yes" />
    <Icon Id="ProductIcon" SourceFile="$(var.SolutionDir)coffee_manager\res\coffee_manager.ico"/>
    <Property Id="ARPPRODUCTICON" Value="ProductIcon"/>
    <Property Id="ARPHELPLINK" Value="$(var.Pre_HomePage)"/>
    <Property Id="ARPURLINFOABOUT" Value="$(var.Pre_HomePage)"/>
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
    <Property Id="ARPNOMODIFY" Value="yes" Secure="yes" />
    <Property Id="ApplicationFolderName" Value="$(var.Pre_DirName_Manufacturer)\$(var.Pre_DirName_developer_id)\$(var.Pre_DirName_ProductName)" />
    <Property Id="WixAppFolder" Value="WixPerMachineFolder" />

    <Upgrade Id="$(var.Pre_ProductUpgradeCode)">
      <UpgradeVersion Minimum="$(var.Pre_ProductVersion)" OnlyDetect="yes" Property="NEWERVERSIONDETECTED"/>
      <UpgradeVersion Minimum="0.0.0" Maximum="$(var.Pre_ProductVersion)" IncludeMinimum="yes" IncludeMaximum="no" Property="OLDERVERSIONBEINGUPGRADED"/>
    </Upgrade>
    <Condition Message="A newer version of this software is already installed.">NOT NEWERVERSIONDETECTED</Condition>

    <Condition Message="This application is only supported on Windows 10 or higher.">
      <![CDATA[Installed OR (VersionNT >= 603)]]>
    </Condition>

    <!-- UI part -->
    <WixVariable Id="PATH_LICENSE_FILE" Overridable="yes" Value="$(var.ProjectDir)license.rtf" />

    <WixVariable Id="WixUISupportPerUser" Value="0" />
    <WixVariable Id="WixUILicenseRtf" Overridable="yes" Value="$(var.ProjectDir)license.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="$(var.ProjectDir)res\WixUIBannerBmp.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="$(var.ProjectDir)res\WixUIDialogBmp.bmp" />

    <UIRef Id="cm_WixUI_Mondo" />
    <!-- WixUI_Mondo, WixUI_InstallDir , WixUI_Advanced , WixUI_Minimal -->
    <UIRef Id="WixUI_ErrorProgressText" />

    <!-- copy file part -->
    <Feature Id="Complete" Title="installation $(var.Pre_ProductName)" Description ="$(var.Pre_ProductName) v$(var.Pre_ProductVersion) software components" Level="1"
             Absent ="disallow"
             AllowAdvertise ="no"
             TypicalDefault ="install"
             InstallDefault="local">

      <!-- executable file -->
      <ComponentGroupRef Id="CG_BIN" />
      <ComponentGroupRef Id="CG_DLL_x86" />
      <ComponentGroupRef Id="CG_DLL_x64" />
      <ComponentGroupRef Id="CG_SERVICE_DLL_DEF" />

      <!-- program data -->
      <ComponentGroupRef Id="CG_SERVICE_INI" />
      <ComponentGroupRef Id="CG_APP_INI" />
      <ComponentGroupRef Id="CG_APP_FILTER" />
      <ComponentGroupRef Id="CG_APP_SERVER" />
      <ComponentGroupRef Id="CG_APP_ROOT" />
      <ComponentGroupRef Id="CG_APP_TEMP" />
      <ComponentGroupRef Id="CG_APP_SERVICE_DLL_3TH_FOLDER" />

      <!-- document -->
      <ComponentGroupRef Id="CG_LICENSE" />

      <!-- short cut processing -->
      <ComponentGroupRef Id="CG_SC_PRODUCT" />
    </Feature>

    <InstallExecuteSequence>
      <!-- <ScheduleReboot After='InstallFinalize' /> -->
      <RemoveExistingProducts After="InstallValidate" Suppress="no"/>
      <!-- InstallValidate : Verifies that all costed volumes have enough space for the installation. -->

      <Custom Action="CA_CommitInstall" Before="InstallFinalize" >NOT Installed</Custom>
      <Custom Action="CA_InstallCert" After="CA_CommitInstall" >NOT Installed</Custom>
      <Custom Action="CA_InstallSvr" After="CA_InstallCert" >NOT Installed</Custom>
      <Custom Action="CA_StartSvr" After="CA_InstallSvr" >NOT Installed</Custom>

      <Custom Action="CA_Rollback" After="InstallInitialize" >NOT Installed</Custom>

      <Custom Action="CA_BeforeUninstall" After="InstallInitialize" >Installed</Custom>
      <Custom Action="CA_StopSvr" After="CA_BeforeUninstall" >Installed</Custom>
      <Custom Action="CA_UninstallSvr" After="CA_StopSvr" >Installed</Custom>
      <Custom Action="CA_RemoveCert" After="CA_UninstallSvr" >Installed</Custom>
      <Custom Action="CA_RemoveAll" After="CA_RemoveCert" >Installed</Custom>

      <!-- InstallValidate InstallInitialize InstallFiles -->
    </InstallExecuteSequence>

    <WixVariable Id="PLATHOME_VAR" Overridable="yes" Value="$(var.Pre_PlatformPath)"/>

    <?if $(var.Pre_PlatformPath) = "x86" ?>
    <WixVariable Id="DIR_BIN" Overridable="yes" Value="$(var.SolutionDir)Release\"  />
    <WixVariable Id="DIR_DLL" Overridable="yes" Value="$(var.SolutionDir)Release\"  />
    <WixVariable Id="DIR_DLL_EXTERN" Overridable="yes" Value="$(var.SolutionDir)extern\dll\x86\"  />
    <?else ?>
    <WixVariable Id="DIR_BIN" Overridable="yes" Value="$(var.SolutionDir)x64\Release\"  />
    <WixVariable Id="DIR_DLL" Overridable="yes" Value="$(var.SolutionDir)x64\Release\"  />
    <WixVariable Id="DIR_DLL_EXTERN" Overridable="yes" Value="$(var.SolutionDir)extern\dll\x64\"  />
    <?endif ?>

    <WixVariable Id="DIR_DLL_x64" Overridable="yes" Value="$(var.SolutionDir)x64\Release\"  />
    <WixVariable Id="DIR_DLL_x64_EXTERN" Overridable="yes" Value="$(var.SolutionDir)extern\dll\x64\"  />

    <WixVariable Id="DIR_DOC" Overridable="yes" Value="$(var.SolutionDir)doc\"  />

    <WixVariable Id="PATH_ICON_COFFEE_MANAGER" Overridable="yes" Value="$(var.SolutionDir)coffee_manager\res\coffee_manager.ico"  />
    <WixVariable Id="DIR_SERVICE_INI" Overridable="yes" Value="$(var.SolutionDir)ProgramData\elpusk\00000006\coffee_service\"  />
    <WixVariable Id="DIR_APP_INI" Overridable="yes" Value="$(var.SolutionDir)ProgramData\elpusk\00000006\coffee_manager\"  />
    <WixVariable Id="DIR_APP_DATA_FILTER" Overridable="yes" Value="$(var.SolutionDir)ProgramData\elpusk\00000006\coffee_manager\data\filter\"  />
    <WixVariable Id="DIR_APP_DATA_SERVER" Overridable="yes" Value="$(var.SolutionDir)ProgramData\elpusk\00000006\coffee_manager\data\server\"  />
    <WixVariable Id="DIR_APP_ROOT" Overridable="yes" Value="$(var.SolutionDir)ProgramData\elpusk\00000006\coffee_manager\root\"  />
    <WixVariable Id="DIR_APP_ROOT_TEMP" Overridable="yes" Value="$(var.SolutionDir)ProgramData\elpusk\00000006\coffee_manager\root\temp\"  />
    <WixVariable Id="DIR_APP_SERVICE_DLL_3TH" Overridable="yes" Value="$(var.SolutionDir)extern\service\"  />
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="$(var.PlatformProgramFilesFolder)">
        <Directory Id="MANUFOLDER" Name="$(var.Pre_DirName_Manufacturer)">
          <Directory Id="DEVELOPER_ID_FOLDER" Name="$(var.Pre_DirName_developer_id)">
            <Directory Id="APPLICATIONFOLDER" Name="$(var.Pre_DirName_ProductName)">
              <Directory Id="DOC_FOLDER" Name="doc"/>
              <Directory Id="BIN_FOLDER" Name="bin"/>
              <Directory Id="SERVICE_FOLDER" Name="service"/>
              <Directory Id="DLL_BASE_FOLDER" Name="dll">
                <Directory Id="DLL_x86_FOLDER" Name="x86"/>
                <Directory Id="DLL_x64_FOLDER" Name="x64"/>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="CommonAppDataFolder">
        <Directory Id="CAD_MANUFOLDER" Name="$(var.Pre_DirName_Manufacturer)">
          <Directory Id="CAD_DEVELOPER_ID_FOLDER" Name="$(var.Pre_DirName_developer_id)">
            <Directory Id="CAD_SERVICE_FOLDER" Name="$(var.Pre_DirName_ServiceName)"/>
            <Directory Id="CAD_APPLICATIONFOLDER" Name="$(var.Pre_DirName_ProductName)">
              <Directory Id="CAD_DATA_FOLDER" Name="data">
                <Directory Id="CAD_FILTER_FOLDER" Name="filter"/>
                <Directory Id="CAD_SERVER_FOLDER" Name="server"/>
              </Directory>
              <Directory Id="CAD_ROOT_FOLDER" Name="root">
                <Directory Id="CAD_TEMP_FOLDER" Name="temp"/>
              </Directory>
              <Directory Id="CAD_SERVICE_DLL_3TH_FOLDER" Name="service"/>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="SC_MANU_FOLDER" Name="$(var.Pre_DirName_Manufacturer)">
          <Directory Id="SC_PRODUCT_FOLDER" Name="$(var.Pre_DirName_ProductName)"/>
        </Directory>
      </Directory>
    </Directory>

  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_LICENSE" Directory="DOC_FOLDER">
      <Component Id="co_license_openssl.txt" Guid = "CE048FFC-4D12-4767-9CE7-72A71550CE3C" Win64="$(var.Pre_Win64)" >
        <File Id="file_license_openssl.txt" Name="license_openssl.txt" Source="!(wix.DIR_DOC)license_openssl.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
      <Component Id="co_LICENSE_1_0_boost.txt" Guid = "08333E4E-5E9B-4DAE-A934-9ED572E80B55" Win64="$(var.Pre_Win64)" >
        <File Id="file_LICENSE_1_0_boost.txt" Name="LICENSE_1_0_boost.txt" Source="!(wix.DIR_DOC)LICENSE_1_0_boost.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
      <Component Id="co_license_nlohmann_json.txt" Guid = "2DA4BF67-F23F-47F0-8EF2-641C3E367D3E" Win64="$(var.Pre_Win64)" >
        <File Id="file_license_nlohmann_json.txt" Name="license_nlohmann_json.txt" Source="!(wix.DIR_DOC)license_nlohmann_json.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_BIN" Directory="BIN_FOLDER">
      <Component Id="co_coffee_manager.exe" Guid = "F16AAD9E-1E22-469D-8632-5C4CAA90CE78" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_manager.exe" Name="coffee_manager.exe" Source="!(wix.DIR_BIN)coffee_manager.exe" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_coffee_service.exe" Guid = "F8F945AA-11E9-48B1-BE5E-14B5921E65B3" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_service.exe" Name="coffee_service.exe" Source="!(wix.DIR_BIN)coffee_service.exe" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_coffee_config.exe" Guid = "28CC7E1C-38FD-4507-8654-381B31B4A832" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_config.exe" Name="coffee_config.exe" Source="!(wix.DIR_BIN)coffee_config.exe" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_coffee_control.exe" Guid = "446366C6-8F3A-43B7-807C-898B45121C7A" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_control.exe" Name="coffee_control.exe" Source="!(wix.DIR_BIN)coffee_control.exe" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_cm_boot_manager.exe" Guid = "2F2C1E52-FE5B-49B8-8203-46A4F6990C6F" Win64="$(var.Pre_Win64)" >
        <File Id="file_cm_boot_manager.exe" Name="cm_boot_manager.exe" Source="!(wix.DIR_BIN)cm_boot_manager.exe" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_SERVICE_DLL_DEF" Directory="SERVICE_FOLDER">
      <Component Id="co_sd_helloworld.dll" Guid = "F174C775-2E12-414A-907E-6CDD5F4D74CB" Win64="$(var.Pre_Win64)" >
        <File Id="file_sd_helloworld.dll" Name="sd_helloworld.dll" Source="!(wix.DIR_BIN)sd_helloworld.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_DLL_x86" Directory="DLL_x86_FOLDER">
      <Component Id="co_coffee_hlp_client.dll" Guid = "42335DD4-DCA5-4136-BA77-0E3F57D00A54" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_hlp_client.dll" Name="coffee_hlp_client.dll" Source="!(wix.DIR_DLL)coffee_hlp_client.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_coffee_hlp_cert.dll" Guid = "BF1B71DB-7556-4E76-8B39-ED0508920CB7" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_hlp_cert.dll" Name="coffee_hlp_cert.dll" Source="!(wix.DIR_DLL)coffee_hlp_cert.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_tg_rom.dll" Guid = "884890D5-D168-4A8B-B5BD-7FB721A5B05C" Win64="$(var.Pre_Win64)" >
        <File Id="file_tg_rom.dll" Name="tg_rom.dll" Source="!(wix.DIR_DLL_EXTERN)tg_rom.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_tg_lpu237_dll.dll" Guid = "A105FE43-BEFA-43FD-AA74-42DCA656B163" Win64="$(var.Pre_Win64)" >
        <File Id="file_tg_lpu237_dll.dll" Name="tg_lpu237_dll.dll" Source="!(wix.DIR_DLL)tg_lpu237_dll.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_tg_lpu237_fw.dll" Guid = "33B831A9-0363-4B84-A737-58180CD732F3" Win64="$(var.Pre_Win64)" >
        <File Id="file_tg_lpu237_fw.dll" Name="tg_lpu237_fw.dll" Source="!(wix.DIR_DLL_EXTERN)tg_lpu237_fw.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_cf_bl_elpusk_hid.dll" Guid = "13647F11-FD4B-4B38-A245-CA2C41EFC30C" Win64="$(var.Pre_Win64)" >
        <File Id="file_cf_bl_elpusk_hid.dll" Name="cf_bl_elpusk_hid.dll" Source="!(wix.DIR_DLL)cf_bl_elpusk_hid.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_cm_bl_hid_elpusk.dll" Guid = "508B7C0A-CBDD-44CB-819E-4A97276305C6" Win64="$(var.Pre_Win64)" >
        <File Id="file_cm_bl_hid_elpusk.dll" Name="cm_bl_hid_elpusk.dll" Source="!(wix.DIR_DLL)cm_bl_hid_elpusk.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_DLL_x64" Directory="DLL_x64_FOLDER">
      <Component Id="co_coffee_hlp_client.dll_x64" Guid = "2DA2CA76-B07D-4593-AB94-ACFE37F789BF" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_hlp_client.dll_x64" Name="coffee_hlp_client.dll" Source="!(wix.DIR_DLL_x64)coffee_hlp_client.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_coffee_hlp_cert.dll_x64" Guid = "63B85D25-6E95-47F8-8E62-D9A71F2BC54A" Win64="$(var.Pre_Win64)" >
        <File Id="file_coffee_hlp_cert.dll_x64" Name="coffee_hlp_cert.dll" Source="!(wix.DIR_DLL_x64)coffee_hlp_cert.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_tg_rom.dll_x64" Guid = "6D7B46C0-110C-4CE1-BA1E-13072AE2E9DA" Win64="$(var.Pre_Win64)" >
        <File Id="file_tg_rom.dll_x64" Name="tg_rom.dll" Source="!(wix.DIR_DLL_x64_EXTERN)tg_rom.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>

      <Component Id="co_tg_lpu237_dll.dll_x64" Guid = "E2A96ED5-7610-45A0-ABB9-25D4509FD0A0" Win64="$(var.Pre_Win64)" >
        <File Id="file_tg_lpu237_dll.dll_x64" Name="tg_lpu237_dll.dll" Source="!(wix.DIR_DLL_x64)tg_lpu237_dll.dll" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_SERVICE_INI" Directory="CAD_SERVICE_FOLDER">
      <Component Id="co_coffee_service.xml" Guid = "687B93F4-3EFD-46D1-809B-881F549A9002" Win64="$(var.Pre_Win64)">
        <File Id="file_coffee_service.xml" Name="coffee_service.xml" Source="!(wix.DIR_SERVICE_INI)coffee_service.xml" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_INI" Directory="CAD_APPLICATIONFOLDER">
      <Component Id="co_coffee_manager.xml" Guid = "4B932BC9-0C7E-4421-8789-86272917148F" Win64="$(var.Pre_Win64)">
        <File Id="file_coffee_manager.xml" Name="coffee_manager.xml" Source="!(wix.DIR_APP_INI)coffee_manager.xml" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_FILTER" Directory="CAD_FILTER_FOLDER">
      <Component Id="co_device.xml" Guid = "BED1E280-8055-4B13-8962-4C193648EE13" Win64="$(var.Pre_Win64)">
        <File Id="file_device.xml" Name="device.xml" Source="!(wix.DIR_APP_DATA_FILTER)device.xml" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_SERVER" Directory="CAD_SERVER_FOLDER">
      <Component Id="co_donotdelete.txt" Guid = "93128B0D-3234-4D69-8166-00AD0138BD6A" Win64="$(var.Pre_Win64)">
        <File Id="file_donotdelete.txt" Name="donotdelete.txt" Source="!(wix.DIR_APP_DATA_SERVER)donotdelete.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_ROOT" Directory="CAD_ROOT_FOLDER">
      <Component Id="co_root_this_folder.txt" Guid = "6B0B55DF-8DA0-4A66-9A49-51D55602E271" Win64="$(var.Pre_Win64)">
        <File Id="file_root_this_folder.txt" Name="this_folder.txt" Source="!(wix.DIR_APP_ROOT)this_folder.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_TEMP" Directory="CAD_TEMP_FOLDER">
      <Component Id="co_temp_this_folder.txt" Guid = "6E1473DB-DAAB-4325-935A-EDAC87CF1D4F" Win64="$(var.Pre_Win64)">
        <File Id="file_temp_this_folder.txt" Name="this_folder.txt" Source="!(wix.DIR_APP_ROOT_TEMP)this_folder.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_SERVICE_DLL_3TH_FOLDER" Directory="CAD_SERVICE_DLL_3TH_FOLDER">
      <Component Id="co_service_dll_readme.txt" Guid = "1A4AE996-E273-48FB-B8D2-37AA7DC2145F" Win64="$(var.Pre_Win64)">
        <File Id="file_service_dll_readme.txt" Name="readme.txt" Source="!(wix.DIR_APP_SERVICE_DLL_3TH)readme.txt" KeyPath="yes" Checksum="yes" ProcessorArchitecture="$(var.Pre_ProcessorArchitecture)"/>
      </Component>
    </ComponentGroup>
  </Fragment>
  <!-- ======================================= -->
  <!-- short cut part -->
  <!-- ======================================= -->

  <Fragment>
    <ComponentGroup Id="CG_SC_PRODUCT" Directory="SC_PRODUCT_FOLDER">
      <Component Id="co_sc.product" Guid="F1105510-E09D-426C-B9D6-3B6820EC7893" Win64="$(var.Pre_Win64)">
        <Shortcut Id="sc.coffee_control.exe"
                  Name="coffee_control"
                  Description="vendor defined usb io platform"
                  Target="[#file_coffee_control.exe]"
                  WorkingDirectory="BIN_FOLDER"/>

        <Shortcut Id="sc_uninstall_Product"
                  Name="Uninstall"
                  Description="Uninstalls $(var.Pre_ProductName) software components"
                  Target="[SystemFolder]msiexec.exe"
                  Arguments="/x [ProductCode]"/>
        <RemoveFolder Id="clean_up_short_cut" Directory="SC_PRODUCT_FOLDER" On="uninstall"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <!-- ======================================= -->
  <!-- logging part -->
  <!-- ======================================= -->

  <!-- ======================================= -->
  <!-- UI part -->
  <!-- ======================================= -->

  <!-- ======================================= -->
  <!-- Custom action part -->
  <!-- ======================================= -->
  <Fragment>

    <CustomAction Id="CA_CommitInstall" Execute="commit" Impersonate="no" Script="vbscript">
      <!-- msgbox "CA1 commit - install" -->
    </CustomAction>

    <CustomAction Id="CA_Rollback" Execute="rollback" Script="vbscript">
      <!-- msgbox "CA6 rollback" -->
    </CustomAction>

    <CustomAction Id="CA_BeforeUninstall" Execute="deferred" Script="vbscript">
      <!-- msgbox "CA8 deferred - uninstall" -->
    </CustomAction>

  </Fragment>

  <Fragment>
    <CustomAction Id="CA_InstallCert" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_config.exe /certificate" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_InstallSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -i" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_StartSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -r" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_StopSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -k" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_UninstallSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -u" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_RemoveCert" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_config.exe /remove"  Return="ignore" Impersonate="no" Execute="deferred"/>

    <CustomAction Id="CA_RemoveAll" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_config.exe /removeall"  Return="ignore" Impersonate="no" Execute="deferred"/>
  </Fragment>

</Wix>
