<?xml version="1.0" encoding="UTF-8"?>

<!--
* history
*
*
* 2022.11.23 - package v 1.11.1 : coffee manager project(1.11.1.0).coffee_manager - v1.11.1 : change openssl to v1.1.1s
*                               : cm_boot_manager.exe - v1.0.1
*                               : coffee_config.exe - v1.3.1
*                               : coffee_control.exe - v1.4
*                               : coffee_service.exe - v1.0
*                               : cf_bl_elpusk_hid.dll - v1.1
*                               : cm_bl_hid_elpusk.dll - v1.2
*                               : coffee_hlp_cert.dll - v1.1.1
*                               : coffee_hlp_client.dll - v1.6.1
*                               : sd_helloworld.dll - v1.2
*                               : tg_lpu237_dll.dll - v4.5
*                               : tg_lpu237_fw.dll - v1.2(external).
*                               : tg_rom.dll - v1.2(external).
*                               : <?define Pre_ProductCode = "DD7577E8-48DB-40AD-84E9-E77725C8EC31"?>
*
* 2025.11 - package v 2.5.0     : coffee manager 2nd project(v2.5) - suuport windows 11 x64.
*                               : elpusk-hid-d.exe - v2.5(from v2.0, this is a new name of coffee_manager.exe)
*                               : tg_lpu237_dll.dll - v6.0
*                               : tg_lpu237_ibutton.dll - v6.0
*                               : lpu230_update.exe - v2.2
*                               : dev_lib.dll - v1.0
*                               : tg_rom.dll - v1.2
-->

<!-- 기본적으로 %ProgramFiles%\Pre_DirName_ProductName\Pre_DirName_Manufacturer 형식으로 설치됨.-->
<!-- Pre_DirName_ 시작하는 정의값은 폴더의 이름임. -->
<?define Pre_DirName_Manufacturer = "Elpusk" ?>
<?define Pre_DirName_developer_id = "00000006" ?>
<?define Pre_DirName_ProductName = "coffee_manager" ?>
<?define Pre_DirName_ServiceName = "coffee_service" ?>

<!-- Pre_Manufacturer name 은 Pre_Manufacturer 에 설정.-->
<?define Pre_Manufacturer = "Elpusk" ?>

<!-- product name 은 Pre_ProductName 에 설정.-->
<?define Pre_ProductName = "coffee_manager_2nd"?>

<!-- Pre_ProductVersion 값이 변경되면, Pre_ProductCode 는 새로 생성해야함.-->
<?define Pre_ProductVersion = "2.5.0"?>
<?define Pre_ProductCode = "56BEB1E3-9FE6-4A25-BA4A-54D1475E100E"?>

<!-- 같은 프로그래은 버전이 달라져도 Pre_ProductUpgradeCode 는 항상 동일해야 함.-->
<?define Pre_ProductUpgradeCode = "B9BF3037-BD17-4F00-BA59-C5CE301723D6"?>

<!-- 32비트면 Pre_PlatformPath(setting 에서 define preprocessor variables 로 설정) 값을 x86 으로 -->
<!-- 64비트면 Pre_PlatformPath 값을 x64 으로 -->
<!-- Pre_ProcessorArchitecture 은 .NET 사용 할때만 의미 있음.-->
<!-- msil , x86, x64 or ia64-->

<!-- 1033(0x0409) en-US : English United States -->
<!-- 1042(0x0412) ko-KR : Korean korea -->
<?define Pre_LCID = "1033" ?>
<!-- The decimal language ID (LCID) for the product. -->

<?define Pre_HomePage = "https://blog.naver.com/elpusk" ?>

<?if $(var.Pre_PlatformPath) = "x64" ?>
  <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?else ?>
  <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?endif ?>


<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
    Id="$(var.Pre_ProductCode)"
    Name="$(var.Pre_ProductName) $(var.Pre_PlatformPath)"
    Language="$(var.Pre_LCID)"
    Version="$(var.Pre_ProductVersion)"
    Manufacturer="$(var.Pre_Manufacturer)"
    UpgradeCode="$(var.Pre_ProductUpgradeCode)"
    >
    <Package
      InstallerVersion="400"
      Compressed="yes"
      InstallScope="perMachine"
      InstallPrivileges="elevated"
      Comments="$(var.Pre_ProductName) $(var.Pre_PlatformPath) v$(var.Pre_ProductVersion) Windows Installer Package."
      Platform="$(var.Pre_PlatformPath)"
      />
    
    <Media Id="1" Cabinet="$(var.TargetName).cab" EmbedCab="yes" />
    <Icon Id="ProductIcon" SourceFile="!(wix.PATH_SRC_ICON_COFFEE_MANAGER)"/>
    <Property Id="ARPPRODUCTICON" Value="ProductIcon"/>
    <Property Id="ARPHELPLINK" Value="$(var.Pre_HomePage)"/>
    <Property Id="ARPURLINFOABOUT" Value="$(var.Pre_HomePage)"/>
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
    <Property Id="ARPNOMODIFY" Value="yes" Secure="yes" />
    <Property Id="ApplicationFolderName" Value="$(var.Pre_DirName_Manufacturer)\$(var.Pre_DirName_developer_id)\$(var.Pre_DirName_ProductName)" />
    <Property Id="WixAppFolder" Value="WixPerMachineFolder" />

    <Upgrade Id="$(var.Pre_ProductUpgradeCode)">
      <UpgradeVersion Minimum="$(var.Pre_ProductVersion)" OnlyDetect="yes" Property="NEWERVERSIONDETECTED"/>
      <UpgradeVersion Minimum="0.0.0" Maximum="$(var.Pre_ProductVersion)" IncludeMinimum="yes" IncludeMaximum="no" Property="OLDERVERSIONBEINGUPGRADED"/>
    </Upgrade>
    <Condition Message="A newer version of this software is already installed.">NOT NEWERVERSIONDETECTED</Condition>

    <Condition Message="This application is only supported on Windows 10 or higher.">
      <![CDATA[Installed OR (VersionNT >= 603)]]>
    </Condition>

    <!-- UI part -->
    <WixVariable Id="PATH_LICENSE_FILE" Overridable="yes" Value="$(var.ProjectDir)license.rtf" />

    <WixVariable Id="WixUISupportPerUser" Value="0" />
    <WixVariable Id="WixUILicenseRtf" Overridable="yes" Value="$(var.ProjectDir)license.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="$(var.ProjectDir)res\WixUIBannerBmp.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="$(var.ProjectDir)res\WixUIDialogBmp.bmp" />

    <UIRef Id="cm_WixUI_Mondo" />
    <!-- WixUI_Mondo, WixUI_InstallDir , WixUI_Advanced , WixUI_Minimal -->
    <UIRef Id="WixUI_ErrorProgressText" />

    <!-- copy file part -->
    <Feature Id="Complete" 
             Title="installation $(var.Pre_ProductName) $(var.Pre_PlatformPath)" 
             Description ="$(var.Pre_ProductName) $(var.Pre_PlatformPath) v$(var.Pre_ProductVersion) software components" Level="1"
             Absent ="disallow"
             AllowAdvertise ="no"
             TypicalDefault ="install"
             InstallDefault="local">

      <!-- executable file -->
      <ComponentGroupRef Id="CG_BIN" />
      <ComponentGroupRef Id="CG_DLL_x86" />
      <?if $(var.Pre_PlatformPath) = "x64" ?>
        <ComponentGroupRef Id="CG_DLL_x64" />
      <?endif ?>
      
      <!-- program data -->
      <ComponentGroupRef Id="CG_SERVICE_INI" />
      <ComponentGroupRef Id="CG_APP_INI" />
      <ComponentGroupRef Id="CG_APP_SERVER" />
      <ComponentGroupRef Id="CG_APP_ROOT" />
      <ComponentGroupRef Id="CG_APP_TEMP" />

      <!-- document -->
      <ComponentGroupRef Id="CG_LICENSE" />

      <!-- short cut processing -->
      <ComponentGroupRef Id="CG_SC_PRODUCT" />
    </Feature>

    <InstallExecuteSequence>
      <!-- <ScheduleReboot After='InstallFinalize' /> -->
      <RemoveExistingProducts After="InstallValidate" Suppress="no"/>
      <!-- InstallValidate : Verifies that all costed volumes have enough space for the installation. -->

      <Custom Action="CA_CommitInstall" Before="InstallFinalize" >NOT Installed</Custom>
      <Custom Action="CA_InstallCert" After="CA_CommitInstall" >NOT Installed</Custom>
      <Custom Action="CA_InstallSvr" After="CA_InstallCert" >NOT Installed</Custom>
      <Custom Action="CA_StartSvr" After="CA_InstallSvr" >NOT Installed</Custom>

      <Custom Action="CA_Rollback" After="InstallInitialize" >NOT Installed</Custom>

      <Custom Action="CA_BeforeUninstall" After="InstallInitialize" >Installed</Custom>
      <Custom Action="CA_StopSvr" After="CA_BeforeUninstall" >Installed</Custom>
      <Custom Action="CA_UninstallSvr" After="CA_StopSvr" >Installed</Custom>
      <Custom Action="CA_RemoveCert" After="CA_UninstallSvr" >Installed</Custom>
      <Custom Action="CA_RemoveAll" After="CA_RemoveCert" >Installed</Custom>

      <!-- InstallValidate InstallInitialize InstallFiles -->
    </InstallExecuteSequence>

    <WixVariable Id="PLATHOME_VAR" Overridable="yes" Value="$(var.Pre_PlatformPath)"/>

    <?if $(var.Pre_PlatformPath) = "x86" ?>
      <WixVariable Id="DIR_SRC_BIN" Overridable="yes" Value="$(var.SolutionDir)Release\"  />
    <?else ?>
      <WixVariable Id="DIR_SRC_BIN" Overridable="yes" Value="$(var.SolutionDir)x64\Release\"  />
    <?endif ?>

    <WixVariable Id="DIR_SRC_DLL_x86" Overridable="yes" Value="$(var.SolutionDir)Release\"  />
    <WixVariable Id="DIR_SRC_DLL_x86_EXTERN" Overridable="yes" Value="$(var.SolutionDir)extern\dll\x86\"  />

    <WixVariable Id="DIR_SRC_DLL_x64" Overridable="yes" Value="$(var.SolutionDir)x64\Release\"  />
    <WixVariable Id="DIR_SRC_DLL_x64_EXTERN" Overridable="yes" Value="$(var.SolutionDir)extern\dll\x64\"  />

    <WixVariable Id="DIR_SRC_DOC" Overridable="yes" Value="$(var.SolutionDir)doc\"  />

    <WixVariable Id="PATH_SRC_ICON_COFFEE_MANAGER" Overridable="yes" Value="$(var.SolutionDir)coffee_manager\res\coffee_manager.ico"  />
    
    <!-- FOR coffee_service.json -->
    <WixVariable Id="DIR_SRC_SERVICE_INI"          Overridable="yes" Value="$(var.SolutionDir)shared\projects\coffee_service\"  />

    <!-- FOR elpusk-hid-d.json -->
    <WixVariable Id="DIR_SRC_APP_INI"              Overridable="yes" Value="$(var.SolutionDir)shared\projects\ElpuskHidDaemon\"  />
    <WixVariable Id="DIR_SRC_APP_DATA_SERVER"      Overridable="yes" Value="$(var.SolutionDir)shared\projects\ElpuskHidDaemon\"  />
    <WixVariable Id="DIR_SRC_APP_ROOT"             Overridable="yes" Value="$(var.SolutionDir)shared\projects\ElpuskHidDaemon\vroot\"  />
    <WixVariable Id="DIR_SRC_APP_ROOT_TEMP"        Overridable="yes" Value="$(var.SolutionDir)shared\projects\ElpuskHidDaemon\vroot\temp\"  />
  </Product>
  <!-- the end fo Product element -->
  <!-- ========================== -->
  <!-- ========================== -->
  <!-- ========================== -->
  <!-- ========================== -->
  <!-- ========================== -->

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="$(var.PlatformProgramFilesFolder)">
        <Directory Id="MANUFOLDER" Name="$(var.Pre_DirName_Manufacturer)">
          <Directory Id="DEVELOPER_ID_FOLDER" Name="$(var.Pre_DirName_developer_id)">
            <Directory Id="APPLICATIONFOLDER" Name="$(var.Pre_DirName_ProductName)">
              <Directory Id="DOC_FOLDER" Name="doc"/>
              <Directory Id="BIN_FOLDER" Name="bin"/>
              <Directory Id="DLL_BASE_FOLDER" Name="dll">
                <Directory Id="DLL_x86_FOLDER" Name="x86"/>
                <Directory Id="DLL_x64_FOLDER" Name="x64"/>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="CommonAppDataFolder">
        <Directory Id="CAD_MANUFOLDER" Name="$(var.Pre_DirName_Manufacturer)">
          <Directory Id="CAD_DEVELOPER_ID_FOLDER" Name="$(var.Pre_DirName_developer_id)">
            <Directory Id="CAD_SERVICE_FOLDER" Name="$(var.Pre_DirName_ServiceName)"/>
            <Directory Id="CAD_APPLICATIONFOLDER" Name="$(var.Pre_DirName_ProductName)">
              <Directory Id="CAD_DATA_FOLDER" Name="data">
                <Directory Id="CAD_SERVER_FOLDER" Name="server"/>
              </Directory>
              <Directory Id="CAD_ROOT_FOLDER" Name="root">
                <Directory Id="CAD_TEMP_FOLDER" Name="temp"/>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="SC_MANU_FOLDER" Name="$(var.Pre_DirName_Manufacturer)">
          <Directory Id="SC_PRODUCT_FOLDER" Name="$(var.Pre_DirName_ProductName)"/>
        </Directory>
      </Directory>
    </Directory>

  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_LICENSE" Directory="DOC_FOLDER">
      <Component Id="co_license.txt" Guid = "E80F57EA-8A0B-49C5-BEFD-B8676AEF2863" >
        <File Id="file_license_coffee_manager_2nd.txt" Name="license_coffee_manager_2nd.txt" Source="!(wix.DIR_SRC_DOC)license_coffee_manager_2nd.txt" KeyPath="yes"/>
        <File Id="file_license_openssl.txt" Name="license_openssl.txt" Source="!(wix.DIR_SRC_DOC)license_openssl.txt" />
        <File Id="file_LICENSE_1_0_boost.txt" Name="LICENSE_1_0_boost.txt" Source="!(wix.DIR_SRC_DOC)LICENSE_1_0_boost.txt" />
        <File Id="file_license_nlohmann_json.txt" Name="license_nlohmann_json.txt" Source="!(wix.DIR_SRC_DOC)license_nlohmann_json.txt" />
      </Component>

      <Component Id="co_manual.md" Guid = "A3DE6B89-4365-4363-9871-D9AE9ECEB3EA" >
        <File Id="file_lpu237_setting_guide.md" Name="lpu237_setting_guide.md" Source="!(wix.DIR_SRC_DOC)lpu237_setting_guide.md" KeyPath="yes"/>
        <File Id="file_lpu230_api_user_manual.md" Name="lpu230_api_user_manual.md" Source="!(wix.DIR_SRC_DOC)lpu230_api_user_manual.md" />
        <File Id="file_lpu237_api_ibutton_user_manual.md" Name="lpu237_api_ibutton_user_manual.md" Source="!(wix.DIR_SRC_DOC)lpu237_api_ibutton_user_manual.md" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_BIN" Directory="BIN_FOLDER">
      <Component Id="co_elpusk_hid_d.exe" Guid = "F16AAD9E-1E22-469D-8632-5C4CAA90CE78">
        <File Id="file_elpusk_hid_d.exe" Name="elpusk-hid-d.exe" Source="!(wix.DIR_SRC_BIN)elpusk-hid-d.exe" KeyPath="yes" Checksum="yes" />
      </Component>

      <Component Id="co_coffee_service.exe" Guid = "F8F945AA-11E9-48B1-BE5E-14B5921E65B3">
        <File Id="file_coffee_service.exe" Name="coffee_service.exe" Source="!(wix.DIR_SRC_BIN)coffee_service.exe" KeyPath="yes" Checksum="yes" />
      </Component>

      <Component Id="co_lpu230_update.exe" Guid = "2F2C1E52-FE5B-49B8-8203-46A4F6990C6F">
        <File Id="file_lpu230_update.exe" Name="lpu230_update.exe" Source="!(wix.DIR_SRC_BIN)lpu230_update.exe" KeyPath="yes" Checksum="yes" />
      </Component>

    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_DLL_x86" Directory="DLL_x86_FOLDER">
      <Component Id="co_tg_rom.dll_x86" Guid = "884890D5-D168-4A8B-B5BD-7FB721A5B05C">
        <File Id="file_tg_rom.dll_x86" Name="tg_rom.dll" Source="!(wix.DIR_SRC_DLL_x86)tg_rom.dll" KeyPath="yes" Checksum="yes" />
      </Component>

      <Component Id="co_tg_lpu237_dll.dll_x86" Guid = "A105FE43-BEFA-43FD-AA74-42DCA656B163">
        <File Id="file_tg_lpu237_dll.dll_x86" Name="tg_lpu237_dll.dll" Source="!(wix.DIR_SRC_DLL_x86)tg_lpu237_dll.dll" KeyPath="yes" Checksum="yes" />
      </Component>

      <Component Id="co_tg_lpu237_ibutton.dll_x86" Guid = "13647F11-FD4B-4B38-A245-CA2C41EFC30C">
        <File Id="file_tg_lpu237_ibutton.dll_x86" Name="tg_lpu237_ibutton.dll" Source="!(wix.DIR_SRC_DLL_x86)tg_lpu237_ibutton.dll" KeyPath="yes" Checksum="yes" />
      </Component>

      <Component Id="co_dev_lib.dll_x86" Guid = "508B7C0A-CBDD-44CB-819E-4A97276305C6">
        <File Id="file_dev_lib.dll_x86" Name="dev_lib.dll" Source="!(wix.DIR_SRC_DLL_x86)dev_lib.dll" KeyPath="yes" Checksum="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_DLL_x64" Directory="DLL_x64_FOLDER">
      <Component Id="co_tg_rom.dll_x64" Guid = "6D7B46C0-110C-4CE1-BA1E-13072AE2E9DA">
        <File Id="file_tg_rom.dll_x64" Name="tg_rom.dll" Source="!(wix.DIR_SRC_DLL_x64)tg_rom.dll" KeyPath="yes" Checksum="yes" />
        <Condition> VersionNT64 </Condition>
      </Component>

      <Component Id="co_tg_lpu237_dll.dll_x64" Guid = "E2A96ED5-7610-45A0-ABB9-25D4509FD0A0">
        <File Id="file_tg_lpu237_dll.dll_x64" Name="tg_lpu237_dll.dll" Source="!(wix.DIR_SRC_DLL_x64)tg_lpu237_dll.dll" KeyPath="yes" Checksum="yes" />
        <Condition> VersionNT64 </Condition>
      </Component>

      <Component Id="co_tg_lpu237_ibutton.dll_x64" Guid = "4BD9DE56-7B5C-478D-A8C7-60FE09A5DA78">
        <File Id="file_tg_lpu237_ibutton.dll_x64" Name="tg_lpu237_ibutton.dll" Source="!(wix.DIR_SRC_DLL_x64)tg_lpu237_ibutton.dll" KeyPath="yes" Checksum="yes"/>
        <Condition> VersionNT64 </Condition>
      </Component>

      <Component Id="co_dev_lib.dll_x64" Guid = "B4D3CECF-5928-4094-851A-80422F3B1E81">
        <File Id="file_dev_lib.dll_x64" Name="dev_lib.dll" Source="!(wix.DIR_SRC_DLL_x64)dev_lib.dll" KeyPath="yes" Checksum="yes" />
        <Condition> VersionNT64 </Condition>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_SERVICE_INI" Directory="CAD_SERVICE_FOLDER">
      <Component Id="co_coffee_service.json" Guid = "687B93F4-3EFD-46D1-809B-881F549A9002">
        <File Id="file_coffee_service.json" Name="coffee_service.json" Source="!(wix.DIR_SRC_SERVICE_INI)coffee_service.json" KeyPath="yes" Checksum="no" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_INI" Directory="CAD_APPLICATIONFOLDER">
      <Component Id="co_elpusk_hid_d.json" Guid = "4B932BC9-0C7E-4421-8789-86272917148F">
        <File Id="file_elpusk_hid_d.json" Name="elpusk-hid-d.json" Source="!(wix.DIR_SRC_APP_INI)elpusk-hid-d.json" KeyPath="yes" Checksum="no" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_SERVER" Directory="CAD_SERVER_FOLDER">
      <Component Id="co_donotdelete.txt" Guid = "93128B0D-3234-4D69-8166-00AD0138BD6A">
        <File Id="file_donotdelete.txt" Name="donotdelete.txt" Source="!(wix.DIR_SRC_APP_DATA_SERVER)donotdelete.txt" KeyPath="yes" Checksum="no" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_ROOT" Directory="CAD_ROOT_FOLDER">
      <Component Id="co_root_this_folder.txt" Guid = "6B0B55DF-8DA0-4A66-9A49-51D55602E271">
        <File Id="file_root_this_folder.txt" Name="this_folder.txt" Source="!(wix.DIR_SRC_APP_ROOT)this_folder.txt" KeyPath="yes" Checksum="no" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_APP_TEMP" Directory="CAD_TEMP_FOLDER">
      <Component Id="co_temp_this_folder.txt" Guid = "6E1473DB-DAAB-4325-935A-EDAC87CF1D4F">
        <File Id="file_temp_this_folder.txt" Name="this_folder.txt" Source="!(wix.DIR_SRC_APP_ROOT_TEMP)this_folder.txt" KeyPath="yes" Checksum="no" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <!-- ======================================= -->
  <!-- short cut part -->
  <!-- ======================================= -->

  <Fragment>
    <ComponentGroup Id="CG_SC_PRODUCT" Directory="SC_PRODUCT_FOLDER">
      <Component Id="co_sc.product" Guid="F1105510-E09D-426C-B9D6-3B6820EC7893">
        <Shortcut Id="sc_uninstall_Product"
                  Name="Uninstall"
                  Description="Uninstalls $(var.Pre_ProductName) $(var.Pre_PlatformPath) software components"
                  Target="[SystemFolder]msiexec.exe"
                  Arguments="/x [ProductCode]"/>
        <RemoveFolder Id="clean_up_short_cut" Directory="SC_PRODUCT_FOLDER" On="uninstall"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <!-- ======================================= -->
  <!-- logging part -->
  <!-- ======================================= -->

  <!-- ======================================= -->
  <!-- UI part -->
  <!-- ======================================= -->

  <!-- ======================================= -->
  <!-- Custom action part -->
  <!-- ======================================= -->
  <Fragment>

    <CustomAction Id="CA_CommitInstall" Execute="commit" Impersonate="no" Script="vbscript">
      <!-- msgbox "CA1 commit - install" -->
    </CustomAction>

    <CustomAction Id="CA_Rollback" Execute="rollback" Script="vbscript">
      <!-- msgbox "CA6 rollback" -->
    </CustomAction>

    <CustomAction Id="CA_BeforeUninstall" Execute="deferred" Script="vbscript">
      <!-- msgbox "CA8 deferred - uninstall" -->
    </CustomAction>

  </Fragment>

  <Fragment>
    <CustomAction Id="CA_InstallCert" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]elpusk-hid-d.exe /cert" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_InstallSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -i" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_StartSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -r" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_StopSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -k" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_UninstallSvr" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]coffee_service.exe -u" Return="check" Impersonate="no" Execute="deferred" />

    <CustomAction Id="CA_RemoveCert" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]elpusk-hid-d.exe /removecert"  Return="ignore" Impersonate="no" Execute="deferred"/>

    <CustomAction Id="CA_RemoveAll" Directory="BIN_FOLDER" ExeCommand="[BIN_FOLDER]elpusk-hid-d.exe /removeall"  Return="ignore" Impersonate="no" Execute="deferred"/>
  </Fragment>

</Wix>
